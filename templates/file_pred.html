{% extends "base.html" %}

{% block content %}
            <div class="row">
                <div class="col-7">
                    <h2>Prédiction des clients à partir de données CSV</h2>
                    <br><br>
                    <p>
                        Pour cette section, vous devez suivre la procédure suivante:
                        <br>
                        <ol>
                            <li>insérer les noms des colonnes qui formeront la ligne de l'entête du tableau,</li>
                            <li>insérer les informations d'un client, chaque information se termine par un point-virgule(;),</li>
                            <li>aller à la ligne une fois toutes les informations du client insérées,</li>
                            <li>insérer les informations des clients suivants en reprenant les points 2 et 3,</li>
                            <li>soumettre le csv.</li>
                        </ol>
                    </p>
                </div>
                <div class="col-5">
                    <form enctype="multipart/form-data" action="" method="POST">
                        <input class="btn btn-dark btn-success mt-2 btn-lg" type="file" id="chosen_file" name="chosen_file" accept=".csv, .xlsx, .txt" placeholder="Ouvrir...">
                        <button class="btn btn-dark btn-success mt-2 btn-lg">Soumettre le fichier</button>
                    </form>
                </div>
            </div>
            

            {% if  request.method == 'POST' %}
        <form action="{{url_for('final_file_prediction')}}" method="POST"> 
            <div class="table-responsive">
                <table class="table-responsive table-striped table-bordered table-sm">
                    <caption>Liste des prédictions</caption>
                    <thead>
                        <tr>
                            <th>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" onclick="toggle(this);" value="" id="flexCheckDefault">
                                  </div>
                            </th>

                            <script>
                                function toggle(source) {
                                    var checkboxes = document.querySelectorAll('input[type="checkbox"]');
                                        for (var i = 0; i < checkboxes.length; i++) {
                                            if (checkboxes[i] != source)
                                                checkboxes[i].checked = source.checked;
                                        }
                                    }       
                            </script>
  
                            <!-- 'CLIENTNUM','Gender', 'Marital_Status', 'Income_Category', 'Card_Category', 'Months_Inactive_12_mon', 'Avg_Utilization_Ratio', 'Total_Relationship_Count', 'Attrition_Flag' -->
                            {% for header in fieldnames %}
                            <th> {{header}} </th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody class="table-striped">
                        {% for row in new_results %}
                        {% set new_results_loop = loop %}
                        <tr>
                            {% for index in range(0, len(fieldnames)) %}
                            {% set fieldnames_loop = loop %}

                            {% if ((fieldnames_loop.index ) == 1) %}
                            <td>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="client_num" value="{{row[0]}}" id="flexCheckDefault">
                                  </div>
                            </td> 
                            {% endif %}
                            
                                <td>{{row[index]}}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <input type="hidden" name="all_data" value="{{new_results}}">
            
            <button class="btn btn-dark btn-success mt-2 btn-lg" type="submit">Prédire la selection</button>
        </form>    
            
            {% endif %}

{% endblock content %}